\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{myMacros}

\requirepackage{xkeyval}
\requirepackage{amsmath}
\requirepackage{amssymb}
\requirepackage{amsmath}
\requirepackage{amstext}
\requirepackage{latexsym}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Math symbol acronyms
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatletter
\NewDocumentCommand{\eye}{o}{
  \IfNoValueTF{#1}{\mathbf{I}}%
  {\mathbf{I}_{#1 \times #1}}
}
\newcommand{\speedOfLight}{\textrm{c}}


\newcommand{\constant}{c}
\newcommand{\assocIT}{i}
\newcommand{\sumIndex}{i}

\newtoggle{placeHat}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Position and orientation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\define@key{posVecKeys}{t}[]{%
  \def\posTimeIndex{#1}
}
\define@key{posVecKeys}{f}[]{%
  \def\frame{#1}
}
\define@key{posVecKeys}{obj}[]{%
  \def\obj{#1}
}
\define@key{posVecKeys}{source}[]{%
  \def\source{#1}
}

\define@boolkey+{posVecKeys}{est}[False]{%
  \ifKV@posVecKeys@est
    \toggletrue{placeHat}%
  \else
  \togglefalse{placeHat}
  \fi
}{%
  \togglefalse{placeHat}
}

\presetkeys{posVecKeys}{t,f,est,obj,source}{}

\NewDocumentCommand{\range}{o}{
  \IfNoValueTF{#1}{
    \rho
  }{
    \setkeys{posVecKeys}{#1}
    \ifboolexpr{togl{placeHat}}{\hat{\rho}}{\rho}
    \ifdefempty{\posTimeIndex}{}{[\posTimeIndex]}
    \ifdefempty{\obj}{}{_{\obj}}
    \ifdefempty{\source}{}{^{(\source)}}
    \ifdefempty{\frame}{}{^\frame}
  }
}


\NewDocumentCommand{\posVec}{o}{
  \IfNoValueTF{#1}{
    \mathbf{r}
  }{
    \setkeys{posVecKeys}{#1}
    \ifboolexpr{togl{placeHat}}{\hat{\mathbf{r}}}{\mathbf{r}}
    \ifdefempty{\posTimeIndex}{}{_{\posTimeIndex}}
    \ifdefempty{\frame}{}{^\frame}
    \ifdefempty{\obj}{}{^{(\obj)}}
  }
}


\NewDocumentCommand{\attVec}{o}{
  \IfNoValueTF{#1}{
    \mathbf{q}
  }{
    \setkeys{posVecKeys}{#1}
    \ifboolexpr{togl{placeHat}}{\hat{\mathbf{q}}}{\mathbf{q}}
    \ifdefempty{\posTimeIndex}{}{_{\posTimeIndex}}
    \ifdefempty{\frame}{}{^\frame}
    \ifdefempty{\obj}{}{^{(\obj)}}
  }
}

\NewDocumentCommand{\ScalarAngle}{o}{
  \IfNoValueTF{#1}{
    \theta
  }{
    \setkeys{posVecKeys}{#1}
    \ifboolexpr{togl{placeHat}}{\hat{\theta}}{\theta}
    \ifdefempty{\posTimeIndex}{}{_{\posTimeIndex}}
    \ifdefempty{\frame}{}{^\frame}
    \ifdefempty{\obj}{}{^{(\obj)}}
  }
}

\NewDocumentCommand{\RADEC}{o}{
  \IfNoValueTF{#1}{
    \boldsymbol{\beta}
  }{
    \boldsymbol{\beta}_{#1}
  }
}

  
\newcommand{\navFrame}{N}
\newcommand{\bodyFrame}{B}
\newcommand{\origin}{O}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Dirction Cosine Matrix
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\define@key{DCMKeys}{to}[]{\def\to{#1}}
\define@key{DCMKeys}{from}[]{\def\from{#1}}
\define@key{DCMKeys}{of}[]{\def\of{#1}}
\presetkeys{DCMKeys}{to,from,of}{}
\NewDocumentCommand{\DCM}{o}{
  \IfNoValueTF{#1}{
    \mathbf{C}
  }{
    \setkeys{DCMKeys}{#1}
    \ifdefempty{\of}{
      \mathbf{C}_{\from}^{\to}
    }{
      \mathbf{C}_{\from}^{\to}(\of)
    }
  }
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Unit Vector
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\define@key{unitVecKeys}{timeIndex}[]{%
  \def\timeIndex{#1}
}
\define@key{unitVecKeys}{signalSource}[]{%
  \def\signalSource{#1}
}
\define@choicekey*{unitVecKeys}{frame}[\val\nr]{nav,body,}[]{%
  \ifcase\nr\relax
  \def\frameMacro{\navFrame}
  \or
  \def\frameMacro{\bodyFrame}
  \or
  \def\frameMacro{}
  \fi
}


\presetkeys{unitVecKeys}{timeIndex,signalSource,frame}{}

\NewDocumentCommand{\unitVec}{o}{
  \IfNoValueTF{#1}{\bar{u}}%
  {\setkeys{unitVecKeys}{#1}
    \ifdefempty{\timeIndex}{
      \ifdefempty{\signalSource}%
      {\ifdefempty{\frameMacro}{\bar{u}}{\bar{u}^{\frameMacro}}}
      {\ifdefempty{\frameMacro}{\bar{u}_{\signalSource}}{\bar{u}_{\signalSource}^{\frameMacro}}}
    }{
      \ifdefempty{\signalSource}
      {\ifdefempty{\frameMacro}
        {\bar{u}_{\timeIndex}}{\bar{u}_{\timeIndex}^{\frameMacro}}
      }{
        \ifdefempty{\frameMacro}{\bar{u}_{\timeIndex,\signalSource}}
        {\bar{u}_{\timeIndex,\signalSource}^{\frameMacro}}
      }
    }
  }
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Photon-Related Macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\pois}{\textrm{Pois}}
% \newcommand{\poisNoise}{v_{Pois}}
% \newcommand{\poisNoiseVec}{\mathbf{v}_{Pois}}
% \newcommand{\varPois}{R_{Pois}}
% \newcommand{\varPoisVec}{\mathbf{R}_{Pois}}

\newcommand{\area}{A_D}  % Symbol for area
\newcommand{\tObs}{t_{\textrm{obs}}}
\newcommand{\pulsedFraction}{p_f}
\newcommand{\pulseWidth}{W}


\define@key{fluxKeys}{cT}[]{%
  \def\cT{#1}
}
\define@key{fluxKeys}{dT}[]{%
  \def\dT{#1}
}
\define@key{fluxKeys}{source}[]{%
  \def\source{#1}
}
\define@key{fluxKeys}{f}[]{%
  \def\frame{#1}
}

\presetkeys{fluxKeys}{cT,dT,source,f}{}


% Photon Arrivals
\NewDocumentCommand{\photons}{o}{  % General symbol for photon arrival vector
  \IfNoValueTF{#1}{\tilde{\lambda}}{\tilde{\lambda}_{#1}}
}

\NewDocumentCommand{\photonVec}{o}{  % General symbol for photon arrival vector
  \IfNoValueTF{#1}{\tilde{\boldsymbol{\Lambda}}}{\tilde{\boldsymbol{\Lambda}}_{#1}}
}

% Detector Flux

\NewDocumentCommand{\fluxVec}{o}{  % Symbol for photon flux
  \IfNoValueTF{#1}{\boldsymbol{\Lambda}}
  {
    \setkeys{fluxKeys}{#1}
    \boldsymbol{\Lambda}
    \ifdefempty{\frame}{
      \ifdefempty{\dT}{}{_{\dT}}
    }{
      \ifdefempty{\dT}{_{\frame}}{_{\frame,\dT}}
    }
    \ifdefempty{\source}{}{^{(\source)}}
    \ifdefempty{\cT}{}{({\cT})}
  }
}
\NewDocumentCommand{\flux}{o}{  % Symbol for photon flux vector
  \IfNoValueTF{#1}{\lambda}
  {
    \setkeys{fluxKeys}{#1}
    \lambda
    \ifdefempty{\frame}{
      \ifdefempty{\dT}{}{_{\dT}}
    }{
      \ifdefempty{\dT}{_{\frame}}{_{\frame,\dT}}
    }
    \ifdefempty{\source}{}{^{(\source)}}
    \ifdefempty{\cT}{}{({\cT})}
  }
}

\NewDocumentCommand{\pulsarPeriod}{o}{\IfNoValueTF{#1}{T}{T_{#1}}}
\newcommand{\currentPhoton}{i}
\newcommand{\tCurrent}{k}
\newcommand{\tPrior}{j}

\newcommand{\associationSpace}{\mathbf{A}}
\NewDocumentCommand{\associationEvent}{o}{\IfNoValueTF{#1}{A}{A_{#1}}}
\NewDocumentCommand{\AOA}{o}{\IfNoValueTF{#1}{\boldsymbol{\alpha}}{\boldsymbol{\alpha}_{#1}}}
\NewDocumentCommand{\TOA}{o}{\IfNoValueTF{#1}{t}{t_{#1}}}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Signal Source Macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\csOne}{a}

\newcommand{\obsVol}{V}
\newcommand{\background}{\textrm{bkg}}
\newcommand{\signalIndex}{p}
\newcommand{\signalCount}{N} % Number of signals being tracked
% Symbol for distant signal source
\NewDocumentCommand{\signalSource}{o}{
  \IfNoValueTF{#1}{S}{S^{#1}}
}
\NewDocumentCommand{\LOSVec}{o}{
  \IfNoValueTF{#1}{\boldsymbol{\ell}}{\boldsymbol{\ell}^{(#1)}}
}

\NewDocumentCommand{\TDOA}{o}{
  \IfNoValueTF{#1}{
    \tau
  }{
    \setkeys{posVecKeys}{#1}
    \ifboolexpr{togl{placeHat}}{\hat{\tau}}{\tau}
    \ifdefempty{\obj}{}{_{\obj}}
    \ifdefempty{\posTimeIndex}{}{[\posTimeIndex]}
    \ifdefempty{\source}{}{^{(\source)}}
    \ifdefempty{\frame}{}{^\frame}
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% State vector related acronyms
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\svDim}{m} % Dimension of the state vector

\define@key{svTime}{timeIndex}[\empty]{%
  \def\timeIndex{#1}
}
\define@key{svTime}{given}[]{%
  \def\given{#1}
}
\define@key{svTime}{sub}[]{%
  \def\sub{#1}
}
\define@boolkey+{svTime}{aPriori}[\empty]{%
  \ifKV@svTime@aPriori
    \def\aPrioriSup{-}%
  \else
  \def\aPrioriSup{+}%
  \fi
}{%
  \def\aPrioriSup{\empty}
}
    
\presetkeys{svTime}{timeIndex,aPriori,given,sub}{}

\NewDocumentCommand{\svVar}{o}{
  \IfNoValueTF{#1}{
    \mathbf{P}
  }{
    \setkeys{svTime}{#1}
    \ifdefempty{\given}{
      \mathbf{P}_{\timeIndex}^{\aPrioriSup}
    }{
      \mathbf{P}_{\timeIndex|\given}^{\aPrioriSup}
    }
  }
}  

\NewDocumentCommand{\sv}{o}{%
  \IfNoValueTF{#1}{
    \mathbf{\hat{x}}
  }{
    \setkeys{svTime}{#1}
    \ifdefempty{\given}{
      \left.\mathbf{\hat{x}}_{\timeIndex}^{\aPrioriSup}\right.
    }{
      \left.\mathbf{\hat{x}}_{\timeIndex | \given}^{\aPrioriSup}\right.
    }
  }
}

\NewDocumentCommand{\kalmanGain}{o}{
  \IfNoValueTF{#1}{\mathbf{K}}%
  {\mathbf{K}_{#1}}
}

\NewDocumentCommand{\measurementMatrix}{o}{
  \IfNoValueTF{#1}{\mathbf{H}}{\mathbf{H}_{#1}}
}

\NewDocumentCommand{\measurementNoise}{o}{
  \IfNoValueTF{#1}{v}{v_{#1}}
}  
\NewDocumentCommand{\measurementNoiseVec}{o}{
  \IfNoValueTF{#1}{\mathbf{v}}{\mathbf{v}_{#1}}
}  
\NewDocumentCommand{\measurementNoiseVar}{o}{
  \IfNoValueTF{#1}{\mathbf{R}}{\mathbf{R}_{#1}}
}
\NewDocumentCommand{\measurement}{o}{
  \IfNoValueTF{#1}{y}{y_{#1}}
}  
\NewDocumentCommand{\measurementVec}{o}{
  \IfNoValueTF{#1}{\mathbf{y}}{\mathbf{y}_{#1}}
}  

\NewDocumentCommand{\residual}{o}{
  \IfNoValueTF{#1}{\delta y}{\delta y_{#1}}
}  
\NewDocumentCommand{\residualVec}{o}{
  \IfNoValueTF{#1}{\boldsymbol{\delta} \mathbf{y}}{\boldsymbol{\delta} \mathbf{y}_{#1}}
}  


\NewDocumentCommand{\residualVar}{o}{
  \IfNoValueTF{#1}{\mathbf{S}}{\mathbf{S}_{#1}}
}  

\NewDocumentCommand{\validationThreshold}{}{
\gamma
}  







% 
% Correlation functions
% Correlation (cross or auto)
\newcommand{\corrVectorDim}{n}
\newcommand{\filtTS}{T} % Time-step of the filter
\newcommand{\filterTap}{p}

\define@key{corrVector}{signalA}[]{%
  \def\signalA{#1}
}
\define@key{corrVector}{signalB}[]{%
  \def\signalB{#1}
}
\define@key{corrVector}{time}[]{%
  \def\time{#1}
}

\define@boolkey+{corrVector}{est}[False]{%
  \ifKV@corrVector@est
    \toggletrue{placeHat}%
  \else
    \togglefalse{placeHat}
  \fi
}{%
    \togglefalse{placeHat}
}

\presetkeys{corrVector}{signalA,signalB,time,est}{}


\NewDocumentCommand{\corr}{o}
{
  \IfNoValueTF{#1}{\mathbf{c}}{
    \setkeys{corrVector}{#1}
    \ifboolexpr{togl{placeHat}}{\hat{c}}{c}
    _{\signalA,\signalB}\ifdefempty{\time}{}{\left[\time\right]}
    }
}

\NewDocumentCommand{\corrVec}{o}
{
  \IfNoValueTF{#1}{\mathbf{c}}{
    \setkeys{corrVector}{#1}
    \ifboolexpr{togl{placeHat}}{\hat{\mathbf{c}}}{\mathbf{c}}
    _{\signalA,\signalB}\ifdefempty{\time}{}{\left[\time\right]}
    }
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Statistics macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\NewDocumentCommand{\probability}{o}{%
  \IfNoValueTF{#1}
  {\mathbf{Pr}}
  {\mathbf{Pr}\left[ #1 \right]  }
}

\NewDocumentCommand{\var}{o}{%
  \IfNoValueTF{#1}
  {\textrm{var}}
  {\textrm{var}\left( #1 \right)}
}


\NewDocumentCommand{\expect}{o}{%
  \IfNoValueTF{#1}
  {\mathbb{E}}
  {\mathbb{E}\left[ #1 \right]}
}


\NewDocumentCommand{\normal}{o o}{\mathcal{N}\left[#1, #2\right]}

\NewDocumentCommand{\assocPR}{o}{
  \IfNoValueTF{#1}{\beta}{\beta_{#1}}
}

% \NewDocumentCommand{\max}{o}{\textrm{max}\IfNoValueTF{#1}{}{[#1]}}
